name: decoder/windows-event-decoder/0

sources:
  - decoder/json/0

metadata:
  description: Parent decoder for Windows events
  module: Windows
  compatibility: >
    This decoder has been tested on Wazuh version 4.3
  author:
    name: Wazuh, Inc.
    date: 2023/01/23
  title: This Windows decoders decodes basic field from Windows events
  references:
    - https://learn.microsoft.com/en-us/windows/win32/events/windows-events

check:
  - ~json.Event: +exists

parse:
  logpar:
    - ~json.Event: <~windows/xml/windows>

normalize:
 - map:
   - event.start: $~windows.Event.System.TimeCreated.@SystemTime
   - event.code: $~windows.Event.System.EventID.#text
   - event.id: $~windows.Event.System.EventID.#text
   - event.kind: event
   - event.provider: $~windows.Event.System.Provider.@Name
   - host.name: $~windows.Event.System.Computer.#text
   - winlog.message: $~parsed_json.Message
   - winlog.channel: $~windows.Event.System.Channel.#text
   - winlog.process.pid: $~windows.Event.System.Execution.@ProcessID
   - winlog.process.thread.id: $~windows.Event.System.Execution.@ThreadID
   - winlog.record_id: $~windows.Event.System.EventRecordID.#text
   - winlog.original_event_data: $~windows.Event.EventData

# Set event level
 - check:
    - ~windows.Event.System.Level.#text: "0"
   map:
    - winlog.level: "Audit"

 - check:
    - ~windows.Event.System.Level.#text: "1"
   map:
    - winlog.level: "Critical"

 - check:
    - ~windows.Event.System.Level.#text: "2"
   map:
    - winlog.level: "Error"

 - check:
    - ~windows.Event.System.Level.#text: "3"
   map:
    - winlog.level: "Warning"

 - check:
    - ~windows.Event.System.Level.#text: "4"
   map:
    - winlog.level: "Information"

 - check:
    - ~windows.Event.System.Level.#text: "5"
   map:
    - winlog.level: "Verbose"

# Cleanup
 - map:
   - ~json: +delete
